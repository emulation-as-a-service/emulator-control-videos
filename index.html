<!DOCTYPE html><meta charset="utf-8">

<style>
  a {
    display: block;
  }
</style>

<div id="viewer"></div>

<script type="module">
  const params = Object.fromEntries(
    new URLSearchParams(location.hash.slice(1))
  );
  let { repo, ref, video } = params;

  ref ??= location.pathname.split("/")[3];
  repo ??= location.pathname.split("/").slice(1, 3).join("/");

  if (video) {
    const path = encodeURI(video);
    viewer.innerHTML = `<video crossorigin="anonymous" src="https://raw.githubusercontent.com/${repo}/${ref}/${path}" controls><track src="https://raw.githubusercontent.com/${repo}/${ref}/${path.replace(/\.webm/, ".vtt")}" default></video>`;
  } else {
    document.body.append(
      ...(
        await (
          await fetch(
            `https://api.github.com/repos/${repo}/contents/?${new URLSearchParams(
              { ref }
            )}`
          )
        ).json()
      ).map(
        ({
          path,
          type,
          href = path.match(/\.webm$/)
            ? `#${new URLSearchParams({ ...params, video: path })}`
            : `${path}${type === "dir" ? "/" : ""}`,
        }) =>
          Object.assign(document.createElement("a"), {
            href,
            textContent: path,
            target: "_blank",
          })
      )
    );
  }
</script>
